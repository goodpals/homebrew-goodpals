#!/bin/bash

# Utility to get the checksum of a formula's release.
# e.g. bin/checksum Formula/ye_olde_todos.rb

set -e

# If arg 1 is an empty string
if [ -z "$1" ]; then
  echo "Usage: bin/checksum <formula-file>"
  echo "Example: bin/checksum Formula/ye_olde_todos.rb"
  exit 1
fi

# If arg 1 is not a file
if [ ! -f "$1" ]; then
  echo "Error: File '$1' not found"
  exit 1
fi

# Extract the URL from the formula file
url=$(grep 'url "' "$1" | head -1 | awk -F'"' '{print $2}')

# If URL is empty (i.e. not found/valid in file)
if [ -z "$url" ]; then
  echo "Error: Could not find url in $1"
  exit 1
fi

echo "Downloading $url..."

sha=$(curl -sL "$url" | shasum -a 256 | awk '{print $1}')

echo ""
echo "SHA256:"
echo -e "\033[1;34m$sha\033[0m"
